(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{333:function(e,t,o){"use strict";t.a={data:function(){return{}},methods:{alert:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2e3;this.$message({message:e,type:t,duration:o})},confirm:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"warning",o=arguments.length>2?arguments[2]:void 0;this.$alert(e,"温馨提示",{confirmButtonText:"确定",type:t,callback:o})},prompt:function(e,t){var o=this;this.$confirm(e,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",closeOnClickModal:!1,type:"warning"}).then(t).catch((function(){o.$message({type:"success",message:"您是对的，三思而后行",duration:1e3})}))}}}},339:function(e,t,o){},340:function(e,t,o){},343:function(e,t,o){"use strict";o(37);var n,r=o(4),c=o(133),l=o(134),m=o(333),d={mixins:[l.a,m.a],props:{identity:String,email:String,type:String,mobile:String,isValidate:Boolean},data:function(){return{isSend:!1,countDown:0,timer:null,url:null,msg:null,sendData:null}},methods:{_getCode:(n=Object(r.a)(regeneratorRuntime.mark((function e(){var t,code,data,o=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("email"==this.type?(this.msg="请先输入邮箱并确认身份",this.url=c.g,this.sendData={email:this.email,identity:this.identity}):(this.msg="请输入正确的手机号码",this.url=c.e,this.sendData={mobile:this.mobile,identity:this.identity}),this.isValidate&&this.identity){e.next=4;break}return this.alert(this.msg),e.abrupt("return");case 4:return this.isSend=!0,this.countDown=5,this.timer=setInterval((function(){if(o.countDown<1)return clearInterval(o.timer),void(o.isSend=!1);o.countDown--}),1e3),e.next=9,this.url(this.sendData);case 9:t=e.sent,code=t.code,data=t.data,t.status,t.message,0==code&&this.alert(data.msg,1==this.identity?"success":"warning");case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}},f=o(2),component=Object(f.a)(d,(function(){var e=this.$createElement;return(this._self._c||e)("el-button",{attrs:{type:"primary",loading:this.isSend},on:{click:this._getCode}},[this._v("\n  "+this._s(this.isSend?this.countDown+" 秒后从新获取":"发送"+("email"==this.type?"邮箱":"手机")+"验证码")+"\n")])}),[],!1,null,"06bf4d22",null);t.a=component.exports},349:function(e,t,o){"use strict";var n=o(339);o.n(n).a},350:function(e,t,o){"use strict";var n=o(340);o.n(n).a},353:function(e,t,o){"use strict";o.r(t);o(38),o(37);var n,r,c=o(4),l=(o(7),o(134)),m=o(333),d=o(133),f=o(47),v=function(e){var data=localStorage[e]&&JSON.parse(localStorage[e]);return data||!1},h={props:{activeNames:String,isDisabled:Boolean,index:String}},w=(o(349),o(2)),_=Object(w.a)(h,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"btn-group mt_20"},[o("el-button",{attrs:{size:"small",type:"primary",disabled:e.activeNames==e.index&&e.isDisabled},on:{click:function(t){return e.$emit("uodateUser")}}},[e._v("确定")]),e._v(" "),o("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$emit("changeActive")}}},[e._v("取消")])],1)}),[],!1,null,"36c8d4ad",null).exports,N=o(343),x={mixins:[l.a,m.a],components:{btnGroup:_,getCode:N.a},mounted:function(){var e=this;this.$nextTick((function(){e.useNameLogin=v("user").hasOwnProperty("accountName")}))},data:function(){return{activeNames:"0",isDisabled:!0,useNameLogin:!1,emailValidator:!1,isValidateMobile:!1,temporaryPassword:null,form:JSON.parse(JSON.stringify(this.$store.state.user.UserInfo)),isShowPassword:!1}},methods:{_updateUser:(r=Object(c.a)(regeneratorRuntime.mark((function e(t,data){var o,n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.every((function(e){return"success"===n.$refs[e].validateState}))){e.next=25;break}if(!data.password){e.next=12;break}return e.next=5,this._getPublicKey(data.password);case 5:return data.password=e.sent,e.next=8,this._getPublicKey(data.newPassword);case 8:this.temporaryPassword=data.newPassword=e.sent,this.form.oldPassword="",this.form.newPassword="",this.form.checkPassword="";case 12:return e.next=14,Object(d.m)(data);case 14:if(0==(o=e.sent).code){e.next=17;break}return e.abrupt("return");case 17:(data.accountName||this.temporaryPassword||this.form.email)&&this.isSaveUserName(t.length),sessionStorage.token=o.data.token,this.$store.commit("user/saveUserInfo",o.data.user),this.alert(o.data.msg,"success"),this.activeNames="0",this.isDisabled=!0,e.next=26;break;case 25:this.alert("请检查表单后在进行数据提交");case 26:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)}),isSaveUserName:function(e){var t={accountName:this.form.accountName,email:this.form.email};e>1&&(t.password=this.temporaryPassword);var o,n,r=v("user");r&&r.hasOwnProperty("accountName")&&!this.useNameLogin&&(delete t.accountName,delete r.accountName),o="user",n=Object.assign(r||{password:this.form.password},t),"object"==Object(f.a)(n)?localStorage[o]=JSON.stringify(n):localStorage[o]=n},_destoryUser:(n=Object(c.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.prompt("此操作将永久删除用户信息,是否继续？",Object(c.a)(regeneratorRuntime.mark((function e(){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(d.b)({_id:t.$store.state.user.UserInfo._id});case 2:o=e.sent,n="user",localStorage.removeItem(n),0==o.code?(t.alert("删除用户成功","error",2e3),t.$router.replace("/user/register")):t.alert(o.message);case 5:case"end":return e.stop()}var n}),e)}))));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},computed:{showErrorMessage:function(){return Boolean(this.activeNames)}}},k=(o(350),Object(w.a)(x,(function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"account-container w_840"},[o("el-form",{attrs:{"label-position":"top","label-width":"80px",model:e.form,"show-message":e.showErrorMessage,rules:e.rules}},[o("div",{staticClass:"title-container ft_24 c_6 ft_b mt_30 "},[e._v("账户与安全")]),e._v(" "),o("el-collapse",{attrs:{accordion:!0},on:{change:function(t){e.isDisabled=!0}},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},[o("el-collapse-item",{staticClass:"mt_30",attrs:{name:"1"}},[o("template",{slot:"title"},[o("el-form-item",{ref:"accountName",staticClass:"w_100p",attrs:{prop:"accountName",label:"用户名"}},[o("el-input",{class:{on:"1"==e.activeNames},attrs:{"suffix-icon":"icon iconfont icon-write_fill",placeholder:"请输入用户名"},on:{input:function(t){e.isDisabled=!1,e.activeNames="1"}},model:{value:e.form.accountName,callback:function(t){e.$set(e.form,"accountName",t)},expression:"form.accountName"}})],1)],1),e._v(" "),o("div",{staticClass:"mt_25"},[o("div",{staticClass:"operate-container"},[o("el-switch",{attrs:{"active-text":"使用用户名作为登录凭证"},model:{value:e.useNameLogin,callback:function(t){e.useNameLogin=t},expression:"useNameLogin"}})],1),e._v(" "),o("btn-group",{attrs:{activeNames:e.activeNames,isDisabled:e.isDisabled,index:"1"},on:{uodateUser:function(t){return e._updateUser(["accountName"],{accountName:e.form.accountName})},changeActive:function(t){e.activeNames="0"}}})],1)],2),e._v(" "),o("el-collapse-item",{staticClass:"mt_30",attrs:{name:"2"}},[o("template",{slot:"title"},[o("el-form-item",{ref:"oldPassword",staticClass:"w_100p",attrs:{prop:"oldPassword",label:"密码"}},[o("el-input",{class:{on:"2"==e.activeNames},attrs:{"suffix-icon":"icon iconfont icon-write_fill",placeholder:"修改密码前需要输入当前密码",type:"password"},on:{input:function(t){e.isDisabled=!1,e.activeNames="2"}},model:{value:e.form.oldPassword,callback:function(t){e.$set(e.form,"oldPassword",t)},expression:"form.oldPassword"}})],1)],1),e._v(" "),o("div",{staticClass:"mt_25 "},[o("div",{staticClass:"operate-container"},[o("el-form-item",{ref:"newPassword",attrs:{prop:"newPassword"}},[o("el-input",{attrs:{type:e.isShowPassword?"text":"password",placeholder:"新密码"},on:{input:function(t){e.isDisabled=!1,e.activeNames="2"}},model:{value:e.form.newPassword,callback:function(t){e.$set(e.form,"newPassword",t)},expression:"form.newPassword"}},[o("span",{staticClass:"icon iconfont icon-eye ft_18 c_r",attrs:{slot:"suffix"},on:{click:function(t){e.isShowPassword=!e.isShowPassword}},slot:"suffix"})])],1),e._v(" "),o("el-form-item",{ref:"checkPassword",attrs:{prop:"checkPassword"}},[o("el-input",{attrs:{type:e.isShowPassword?"text":"password",placeholder:"确认新密码"},on:{input:function(t){e.isDisabled=!1,e.activeNames="2"}},model:{value:e.form.checkPassword,callback:function(t){e.$set(e.form,"checkPassword",t)},expression:"form.checkPassword"}},[o("span",{staticClass:"icon iconfont icon-eye ft_18 c_r",attrs:{slot:"suffix"},on:{click:function(t){e.isShowPassword=!e.isShowPassword}},slot:"suffix"})])],1)],1),e._v(" "),o("div",{staticClass:"flex  j_s "},[o("btn-group",{attrs:{activeNames:e.activeNames,isDisabled:e.isDisabled,index:"2"},on:{uodateUser:function(t){return e._updateUser(["oldPassword","newPassword","checkPassword"],{password:e.form.oldPassword,newPassword:e.form.newPassword})},changeActive:function(t){e.activeNames="0"}}}),e._v(" "),o("nuxt-link",{staticClass:"f_x_e ml_20 c_tc",attrs:{to:"/user/resetpassword"}},[e._v("忘记密码")])],1)])],2),e._v(" "),o("el-collapse-item",{staticClass:"mt_30",attrs:{name:"3"}},[o("template",{slot:"title"},[o("el-form-item",{ref:"nickName",staticClass:"w_100p",attrs:{label:"昵称",prop:"nickName"}},[o("el-input",{class:{on:"3"==e.activeNames},attrs:{"suffix-icon":"icon iconfont icon-write_fill",placeholder:"请输入用户昵称"},on:{input:function(t){e.isDisabled=!1,e.activeNames="3"}},model:{value:e.form.nickName,callback:function(t){e.$set(e.form,"nickName",t)},expression:"form.nickName"}})],1)],1),e._v(" "),o("btn-group",{staticClass:"mt_30",attrs:{activeNames:e.activeNames,isDisabled:e.isDisabled,index:"3"},on:{uodateUser:function(t){return e._updateUser(["nickName"],{nickName:e.form.nickName})},changeActive:function(t){e.activeNames="0"}}})],2),e._v(" "),o("el-collapse-item",{staticClass:"mt_30",attrs:{name:"4"}},[o("template",{slot:"title"},[o("el-form-item",{ref:"email",staticClass:"w_100p",attrs:{label:"绑定邮箱",prop:"email"}},[o("el-input",{class:{on:"4"==e.activeNames},attrs:{"suffix-icon":"icon iconfont icon-write_fill",placeholder:"请输入需要修改的邮箱"},on:{input:function(t){e.isDisabled=!1,e.activeNames="4"}},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1)],1),e._v(" "),o("div",{staticClass:"mt_25 "},[o("div",{staticClass:"operate-container"},[o("el-form-item",{attrs:{prop:"code"}},[o("el-input",{attrs:{placeholder:"请输入获取到的验证码"},on:{input:function(t){e.isDisabled=!1,e.activeNames="4"}},model:{value:e.form.code,callback:function(t){e.$set(e.form,"code",t)},expression:"form.code"}},[o("template",{slot:"append"},[o("get-code",{attrs:{isValidate:e.emailValidator,type:"email",identity:e.form.identity,email:e.form.email}})],1)],2)],1)],1),e._v(" "),o("btn-group",{staticClass:"mt_30",attrs:{activeNames:e.activeNames,isDisabled:e.isDisabled,index:"4"},on:{uodateUser:function(t){return e._updateUser(["email"],{email:e.form.email})},changeActive:function(t){e.activeNames="0"}}})],1)],2),e._v(" "),o("el-collapse-item",{staticClass:"mt_30",attrs:{name:"5"}},[o("template",{slot:"title"},[o("el-form-item",{ref:"mobile",staticClass:"w_100p",attrs:{label:"手机号码",prop:"mobile"}},[o("el-input",{class:{on:"5"==e.activeNames},attrs:{"suffix-icon":"icon iconfont icon-write_fill",placeholder:"请输入手机号码"},on:{input:function(t){e.isDisabled=!1,e.activeNames="5"}},model:{value:e.form.mobile,callback:function(t){e.$set(e.form,"mobile",t)},expression:"form.mobile"}})],1)],1),e._v(" "),o("div",{staticClass:"mt_30 "},[o("div",{staticClass:"operate-container"},[o("el-form-item",{attrs:{prop:"mobileCode"}},[o("el-input",{attrs:{placeholder:"请输入获取到的验证码"},on:{input:function(t){e.isDisabled=!1,e.activeNames="5"}},model:{value:e.form.mobileCode,callback:function(t){e.$set(e.form,"mobileCode",t)},expression:"form.mobileCode"}},[o("template",{slot:"append"},[o("get-code",{attrs:{isValidate:e.isValidateMobile,type:"mobile",identity:e.form.identity,mobile:e.form.mobile}})],1)],2)],1)],1),e._v(" "),o("btn-group",{staticClass:"mt_30",attrs:{activeNames:e.activeNames,isDisabled:e.isDisabled,index:"5"},on:{uodateUser:function(t){return e._updateUser(["mobile"],{mobile:e.form.mobile,mobileCode:e.form.mobileCode})},changeActive:function(t){e.activeNames="0"}}})],1)],2)],1)],1),e._v(" "),o("div",{staticClass:"bottom-container ft_24 c_6 ft_b mt_50 "},[e._v("\n    其他\n  ")]),e._v(" "),o("div",{staticClass:"cancel-group mt_30 ml_15 c_6 ft_18"},[o("el-button",{attrs:{type:"danger"},on:{click:e._destoryUser}},[e._v("注销账户")])],1)],1)}),[],!1,null,"c9fc44fe",null));t.default=k.exports}}]);